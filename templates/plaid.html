<!doctype html><meta charset="utf-8"><title>Plaid</title>
<button id="link-button">Link a bank</button>
<div id="out"></div>
<script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
<script>
async function openLink(){
  const tok = await fetch('/plaid/create_link_token',{method:'POST'}).then(r=>r.json());
  if(!tok.link_token){ alert('Failed to create link token'); return; }
  const handler = Plaid.create({
    token: tok.link_token,
    onSuccess: async (public_token) => {
      const res = await fetch('/plaid/exchange_public_token',{
        method:'POST',headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ public_token })
      }).then(r=>r.json());
      document.getElementById('out').textContent = 'Linked âœ“ item_id='+(res.item_id||'?');
    }
  });
  handler.open();
}
document.getElementById('link-button').onclick=openLink;
</script>
